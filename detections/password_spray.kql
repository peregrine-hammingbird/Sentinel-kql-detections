let timeframe = 1h;
let binSize = 5m;
let minFailures = 20;
let minUsers = 8;

SigninLogs
| where TimeGenerated > ago(timeframe)
| where ResultType != 0  // failure (環境によっては要調整)
| summarize
    Failures = count(),
    Users = dcount(UserPrincipalName),
    UserList = make_set(UserPrincipalName, 20),
    Apps = make_set(AppDisplayName, 10)
  by bin(TimeGenerated, binSize), IPAddress
| where Failures >= minFailures and Users >= minUsers
| order by Failures desc

